<!DOCTYPE html>
<html>
<head>
    <title>Payment Status - Simple</title>
    <meta http-equiv="refresh" content="5">
    <style>
        body { 
            font-family: Arial; 
            margin: 20px; 
            background: #f8f9fa;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            color: white;
        }
        .pending { background: #ffc107; }
        .succeeded { background: #28a745; }
        .failed { background: #dc3545; }
        .total { background: #007bff; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
        }
        .status.pending { background: #ffc107; }
        .status.succeeded { background: #28a745; }
        .status.failed { background: #dc3545; }
        
        .refresh-info {
            text-align: center;
            color: #6c757d;
            margin-top: 20px;
        }
        .no-payments {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .quick-actions {
            margin-bottom: 20px;
            text-align: center;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
        }
        .btn:hover {
            background: #0056b3;
        }
        .live-indicator {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ’³ Payment Status Monitor</h1>
        <p>Automatic Stripe Payment Tracking</p>
        <span class="live-indicator">ğŸŸ¢ Live Auto-Approval System</span>
    </div>
    
    <div class="quick-actions">
        <a href="/payments/" class="btn">ğŸ’³ Make New Payment</a>
        <a href="/payments/test-webhook/" class="btn">ğŸ”” Test Webhook</a>
        <a href="/admin/payments/payment/" class="btn">ğŸ›ï¸ Admin Panel</a>
        <a href="/payments/api/payments/" class="btn">ğŸ“Š API Data</a>
    </div>
    
    {% if payments %}
        <div class="stats">
            <div class="stat-card total">
                <h2>{{ total_count }}</h2>
                <p>Total Payments</p>
            </div>
            <div class="stat-card pending">
                <h2>{{ pending_count }}</h2>
                <p>Pending</p>
            </div>
            <div class="stat-card succeeded">
                <h2>{{ succeeded_count }}</h2>
                <p>Succeeded</p>
            </div>
            <div class="stat-card failed">
                <h2>{{ failed_count }}</h2>
                <p>Failed</p>
            </div>
        </div>
        
        <h3>ğŸ“‹ Recent Payments</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Stripe ID</th>
                    <th>User</th>
                    <th>Created</th>
                    <th>Updated</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr {% if payment.status == 'succeeded' %}style="background: #d4edda;"{% endif %}>
                    <td><strong>#{{ payment.id }}</strong></td>
                    <td>${{ payment.amount }}</td>
                    <td>
                        <span class="status {{ payment.status }}">
                            {% if payment.status == 'pending' %}â³ Pending
                            {% elif payment.status == 'succeeded' %}âœ… Succeeded
                            {% elif payment.status == 'failed' %}âŒ Failed
                            {% else %}{{ payment.status }}
                            {% endif %}
                        </span>
                    </td>
                    <td><code>{{ payment.stripe_payment_intent|truncatechars:20 }}</code></td>
                    <td>{{ payment.user|default:"Anonymous" }}</td>
                    <td>{{ payment.created_at|date:"M d H:i" }}</td>
                    <td>{{ payment.updated_at|date:"M d H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="no-payments">
            <h3>ğŸš« No payments found</h3>
            <p>Make your first payment to see automatic status updates here.</p>
            <a href="/payments/" class="btn">ğŸ’³ Make Payment Now</a>
        </div>
    {% endif %}
    
    <div class="refresh-info">
        <p>ğŸ”„ Auto-refresh every 5 seconds | âš¡ Instant status updates via webhook</p>
        <p><strong>How it works:</strong> Payment â†’ Stripe Verify â†’ Auto Success/Fail</p>
        <p><small>Last updated: {{ "now"|date:"M d, Y H:i:s" }}</small></p>
    </div>
</div>

<script>
// Add live pending animation
let dots = 0;
setInterval(() => {
    dots = (dots + 1) % 4;
    const elements = document.querySelectorAll('.status.pending');
    elements.forEach(el => {
        el.innerHTML = 'â³ Pending' + '.'.repeat(dots);
    });
}, 500);

// Flash animation for new succeeded payments
document.addEventListener('DOMContentLoaded', function() {
    const succeededRows = document.querySelectorAll('tr[style*="background: #d4edda"]');
    succeededRows.forEach(row => {
        // Add flash effect
        row.style.animation = 'flash 1s ease-in-out';
    });
});

// Add CSS for flash animation
const style = document.createElement('style');
style.textContent = `
    @keyframes flash {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; background: #b8f5c7 !important; }
    }
`;
document.head.appendChild(style);
</script>

</body>
</html>